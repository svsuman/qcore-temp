const { GetSecretValueCommand } = require("@aws-sdk/client-secrets-manager");
const { GetCallerIdentityCommand } = require("@aws-sdk/client-sts");

exports.getCurrentUser = async function(STSClient) {
  try {
    const command = new GetCallerIdentityCommand({});
    return await STSClient.send(command);
  } catch (error) {
    return null;
  }
}

const cache = {};

exports.getSecretManagerValue = async function(SecretsManagerClient, secretManagerKeyName) {
  const [secretId, key] = secretManagerKeyName.split('#');
  const command = new GetSecretValueCommand({ SecretId: secretId });

  if (!cache[secretId]) {
    cache[secretId] = JSON.parse(
      (await SecretsManagerClient.send(command)).SecretString
    );
  }

  return cache[secretId][key];
}
